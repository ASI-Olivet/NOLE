<!DOCTYPE html>
<html lang="en">
<head>
  <!-- (CSS): Load Leaflet CSS for map rendering -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>NOLE — Tampa Bay Map</title>

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    /* Full-page Leaflet map container */
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #map {
      height: 100%;
      width: 100%;
    }
  </style>
</head>

<body>
  <!-- Map container -->
  <div id="map"></div>

  <!-- Load Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    /* =========================================================
       1. Confirm Leaflet loads properly
    ========================================================= */
    console.log("Leaflet version:", L.version);

    /* =========================================================
       2. Build map and base tile layer
    ========================================================= */
    const map = L.map("map").setView([27.77, -82.64], 10);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "© OpenStreetMap contributors",
    }).addTo(map);

    /* =========================================================
       3. Load a controlled batch of ENC GeoJSON layers (round 2)
          First 2/3 of your list (16 layers)
    ========================================================= */
    const encLayers = [
      // ---- Coastal ----
      {
        name: "Coastal Bridges",
        file: "Coastal_Bridge_area_4326_clipTB.geojson",
        style: {
          color: "#ff00ff",
          weight: 2,
          fillColor: "#ff00ff",
          fillOpacity: 0.3,
        },
      },
      {
        name: "Coastal Buoy Lateral",
        file: "Coastal_Buoy_Lateral_point_4326_clipTB.geojson",
        style: {
          color: "#00ffff",
          weight: 2,
        },
      },
      {
        name: "Coastal Buoy Safe Water",
        file: "Coastal_Buoy_Safe_Water_point_4326_clipTB.geojson",
        style: {
          color: "#00ffff",
          weight: 2,
        },
      },
      {
        name: "Coastal Fairway (clipped)",
        file: "Coastal_Fairway_area_4326_clipTB.geojson",
        style: {
          color: "#00ff00",
          weight: 2,
          fillColor: "#00ff00",
          fillOpacity: 0.2,
        },
      },
      {
        name: "Coastal Radar Transponder Beacons",
        file: "Coastal_Radar_Transponder_Beacon_point_4326_clipTB.geojson",
        style: {
          color: "#ffff00",
          weight: 2,
        },
      },
      {
        name: "Coastal Wrecks",
        file: "Coastal_Wreck_point_4326_clipTB.geojson",
        style: {
          color: "#ff0000",
          weight: 2,
        },
      },

      // ---- General ----
      {
        name: "General Buoy Special Purpose",
        file: "General_Buoy_Special_Purpose_General_point_4326_clipTB.geojson",
        style: {
          color: "#00ffff",
          weight: 2,
        },
      },
      {
        name: "General Obstructions",
        file: "General_Obstruction_area_4326_clipTB.geojson",
        style: {
          color: "#ff6600",
          weight: 2,
          fillColor: "#ff6600",
          fillOpacity: 0.25,
        },
      },

      // ---- Harbour ----
      {
        name: "Harbour Buoy Special Purpose",
        file: "Harbour_Buoy_Special_Purpose_General_point_4326_clipTB.geojson",
        style: {
          color: "#00ffff",
          weight: 2,
        },
      },
      {
        name: "Harbour Submarine Cables",
        file: "Harbour_Cable_Submarine_line_4326_clipTB.geojson",
        style: {
          color: "#00ffff",
          weight: 2,
        },
      },
      {
        name: "Harbour Coastguard Stations",
        file: "Harbour_Coastguard_Station_point_4326_clipTB.geojson",
        style: {
          color: "#ffffff",
          weight: 2,
        },
      },
      {
        name: "Harbour Coastline",
        file: "Harbour_Coastline_line_4326_clipTB.geojson",
        style: {
          color: "#ffffff",
          weight: 1,
        },
      },
      {
        name: "Harbour Fairways",
        file: "Harbour_Fairway_area_4326_clipTB.geojson",
        style: {
          color: "#0000ff",
          weight: 2,
          fillColor: "#0000ff",
          fillOpacity: 0.25,
        },
      },
      {
        name: "Harbour Fog Signals",
        file: "Harbour_Fog_Signal_point_4326_clipTB.geojson",
        style: {
          color: "#ffff00",
          weight: 2,
        },
      },
      {
        name: "Harbour Marine Farms",
        file: "Harbour_Marine_Farm_Culture_area_4326_clipTB.geojson",
        style: {
          color: "#00ff88",
          weight: 2,
          fillColor: "#00ff88",
          fillOpacity: 0.3,
        },
      },
      {
        name: "Harbour Military Practice Areas",
        file: "Harbour_Military_Practice_Area_4326_clipTB.geojson",
        style: {
          color: "#ff0000",
          weight: 2,
          fillColor: "#ff0000",
          fillOpacity: 0.2,
        },
      },
    ];

    let allBounds = null;

    encLayers.forEach((cfg) => {
      fetch(cfg.file)
        .then((response) => {
          console.log(`Fetching ${cfg.name}:`, cfg.file, "status", response.status);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          return response.json();
        })
        .then((data) => {
          console.log(
            `${cfg.name} features:`,
            Array.isArray(data.features) ? data.features.length : "no features array"
          );

          const layer = L.geoJSON(data, {
            style: cfg.style,
          });

          layer.addTo(map);
          layer.bringToFront();

          const bounds = layer.getBounds();
          console.log(`${cfg.name} bounds:`, bounds);

          if (bounds && bounds.isValid && bounds.isValid()) {
            if (allBounds) {
              allBounds.extend(bounds);
            } else {
              allBounds = bounds;
            }
            map.fitBounds(allBounds);
          }
        })
        .catch((err) => {
          console.error(`Error loading ${cfg.name}:`, err);
        });
    });
  </script>
</body>
</html>
