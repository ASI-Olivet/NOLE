<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NOLE — Tampa Bay Map</title>

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />

  <style>
    /* Base page + map */
    html,
    body,
    #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    /* Popups */
    .nole-popup-label {
      font-size: 14px;
      font-weight: 600;
    }

    /* Sidebar */
    #NoleSidebar {
      position: fixed;
      left: 12px;
      bottom: 12px;
      top: auto;
      width: 360px;
      max-width: calc(100vw - 24px);
      padding: 14px;
      border-radius: 14px;
      background-color: #F3CAB5;
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.22);
      z-index: 40000;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    #NoleSidebar .nole-sidebar-header {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    /* Tier containers */
    #NoleSidebar .nole-tier {
      padding: 12px 10px;
      border-radius: 12px;
      border: 2px solid rgba(0, 0, 0, 0.18);
      margin-bottom: 12px;
      background: rgba(255, 255, 255, 0.28);
    }

    /* Make clickable */
    #NoleSidebar .nole-tier-label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      width: 100%;
    }

    #NoleSidebar .nole-tier-title {
      font-size: 15px;
      font-weight: 700;
    }

    #NoleSidebar .nole-tier-desc {
      margin-left: 28px;
      margin-top: 6px;
      font-size: 13px;
      line-height: 1.3;
    }

    #NoleSidebar input[type="radio"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      flex: 0 0 auto;
    }

    /* Select styling radio/text */
    #NoleSidebar input[type="radio"]:checked + .nole-tier-title {
      text-decoration: underline;
    }

    #NoleSidebar .nole-tier:focus-within {
      border-color: rgba(0, 0, 0, 0.45);
      background: rgba(255, 255, 255, 0.5);
    }
  </style>
</head>


<body>

  <!-- Sensory selection sidebar -->
  <div id="NoleSidebar" aria-label="NOLE activity level">
    <div class="nole-sidebar-header">Choose your activity level.</div>

    <div class="nole-tier">
      <label class="nole-tier-label">
        <input type="radio" name="NoleTier" id="TierCalm" checked />
        <span class="nole-tier-title">Calm Coast</span>
      </label>
      <div class="nole-tier-desc">Views of the map and ships</div>
    </div>

    <div class="nole-tier">
      <label class="nole-tier-label">
        <input type="radio" name="NoleTier" id="TierBusy" />
        <span class="nole-tier-title">Busy Bay</span>
      </label>
      <div class="nole-tier-desc">
        Includes map, ships, traffic lanes, and a few key points
      </div>
    </div>

    <div class="nole-tier">
      <label class="nole-tier-label">
        <input type="radio" name="NoleTier" id="TierActive" />
        <span class="nole-tier-title">Active Adventures</span>
      </label>
      <div class="nole-tier-desc">Includes full range of features</div>
    </div>
  </div>

  <div id="map"></div>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    crossorigin=""
  ></script>

  <script>
    // Basemap - pane view
    const tampaBounds = L.latLngBounds(
      [26.9, -83.2], // SW
      [28.6, -81.9]  // NE
    );

    // Draw order for pop-up
    const map = L.map("map", {
      minZoom: 9,
      maxZoom: 18,
      maxBounds: tampaBounds,
      maxBoundsViscosity: 0.9
    }).setView([27.77, -82.64], 11);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18,
      attribution: "© OpenStreetMap contributors, Vessel data from Global Fishing Watch."
    }).addTo(map);

    // Vessels on TOP of ENC layers
    map.createPane("top-vessels");
    map.getPane("top-vessels").style.zIndex = 10000;

    // Popups on TOP of vessels (only when a popup is open)
    map.getPane("popupPane").style.zIndex = 20000;

    const EncBusyBayGroup = L.layerGroup();
    const EncAllLayerGroup = L.layerGroup();

    // Ship Marker: vessels
    function makePortVisitMarker(lat, lon) {
      return L.circleMarker([lat, lon], {
        radius: 12,
        color: "#680093",
        weight: 3,
        fillColor: "#D5FC79",
        fillOpacity: 1.0,
        pane: "top-vessels"
      });
    }

    // ENC GeoJSON layers
    const encLayers = [
      // Coastal
      {
        name: "Coastal Bridges",
        file: "Coastal_Bridge_area_4326_clipTB.geojson",
        label: "Bridge",
        style: { color: "#ff00ff", weight: 2, fillColor: "#ff00ff", fillOpacity: 0.3 }
      },
      {
        name: "Coastal Buoy Lateral",
        file: "Coastal_Buoy_Lateral_point_4326_clipTB.geojson",
        label: "Buoy",
        pointClass: "buoy"
      },
      {
        name: "Coastal Buoy Safe Water",
        file: "Coastal_Buoy_Safe_Water_point_4326_clipTB.geojson",
        label: "Buoy",
        pointClass: "buoy"
      },
      {
        name: "Coastal Fairway (clipped)",
        file: "Coastal_Fairway_area_4326_clipTB.geojson",
        label: "Ship Fairway",
        style: { color: "#00ff00", weight: 2, fillColor: "#00ff00", fillOpacity: 0.2 },
        busyBay: true
      },
      {
        name: "Coastal Radar Transponder Beacons",
        file: "Coastal_Radar_Transponder_Beacon_point_4326_clipTB.geojson",
        label: "Beacon",
        pointClass: "beacon",
        busyBay: true
      },
      {
        name: "Coastal Wrecks",
        file: "Coastal_Wreck_point_4326_clipTB.geojson",
        label: "Wreck",
        pointClass: "wreck"
      }
    ];

    // ENC point symbology
    function makePointMarker(pointClass, latlng) {
      if (pointClass === "buoy") {
        return L.circleMarker(latlng, {
          radius: 5,
          color: "#0432FF",
          weight: 1,
          fillColor: "#0432FF",
          fillOpacity: 0.9
        });
      }

      if (pointClass === "wreck") {
        return L.marker(latlng, {
          icon: L.divIcon({
            className: "",
            iconSize: [16, 16],
            iconAnchor: [8, 8],
            html: '<div style="color:#FF0000;font-size:18px;font-weight:bold;line-height:16px;">×</div>'
          })
        });
      }

      return L.circleMarker(latlng, {
        radius: 5,
        color: "#ADADAD",
        weight: 1,
        fillColor: "#ADADAD",
        fillOpacity: 0.9
      });
    }

    encLayers.forEach(cfg => {
      fetch(cfg.file)
        .then(r => r.json())
        .then(data => {
          const layer = L.geoJSON(data, {
            style: cfg.style,
            pointToLayer: (feature, latlng) =>
              cfg.pointClass
                ? makePointMarker(cfg.pointClass, latlng)
                : makePointMarker("default", latlng),
            onEachFeature: (feature, layer) => {
              layer.bindPopup('<div class="nole-popup-label">' + cfg.label + "</div>");
            }
          });

          EncAllLayerGroup.addLayer(layer);
          if (cfg.busyBay) {
            EncBusyBayGroup.addLayer(layer);
          }
        });
    });
  </script>

</body>
</html>
